# A simple test which sets up a metadata-based subscription to automatically create a replication rule.
# This workflow consists of:
# - Upload of data into new dataset with metadata at RSE 1
# - Creation of metadata-based subscription to replicate to RSE 2
# Data should then be replicated at RSE 2.
metadata-based-replication:
  description: "Upload data and set up a metadata-based subscription for it."
  module_name: "tasks.tests.metadata_replication"
  class_name: "MetadataReplication"
  enabled: true
  args:
  kwargs:
    scope: "ajm_test"
    rse: "SPSRC_STORM"
    size: 10000
    lifetime: 3600
    dataset_name: null
    fixed_metadata: # Explicit k-v pairs to set as metadata
      project: skao_proj_1
    subscription_name: test_subscription
    filters:
      scope:
        - "ajm_test"
      project:
        - skao_proj_1
    replication_rules:
      - copies: 1
        rse_expression: "NLSRC_DCACHE"
        lifetime: 3600
        activity: User Subscriptions
    comments: Test subscription
    subscription_lifetime: 1
    retroactive: false
    dry_run: false
    priority: 3
